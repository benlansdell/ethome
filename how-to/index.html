
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../api-docs/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>How To guide - ethome-ml</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ethome-ml" class="md-header__button md-logo" aria-label="ethome-ml" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ethome-ml
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How To guide
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ethome-ml" class="md-nav__button md-logo" aria-label="ethome-ml" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ethome-ml
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    How To guide
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    How To guide
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-installation" class="md-nav__link">
    <span class="md-ellipsis">
      0 Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-loading-your-data" class="md-nav__link">
    <span class="md-ellipsis">
      1 Loading your data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 Loading your data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1a-loading-nwb-files" class="md-nav__link">
    <span class="md-ellipsis">
      1a Loading NWB files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1b-loading-tracking-files" class="md-nav__link">
    <span class="md-ellipsis">
      1b Loading tracking files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1c-loading-behavioral-annotation-data" class="md-nav__link">
    <span class="md-ellipsis">
      1c Loading behavioral annotation data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1d-loading-video-data" class="md-nav__link">
    <span class="md-ellipsis">
      1d Loading video data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1e-scaling-pose-data" class="md-nav__link">
    <span class="md-ellipsis">
      1e Scaling pose data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1f-renaming-things" class="md-nav__link">
    <span class="md-ellipsis">
      1f Renaming things
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1g-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      1g Metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-interpolate-low-confidence-pose-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      2 Interpolate low-confidence pose tracking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-generate-features" class="md-nav__link">
    <span class="md-ellipsis">
      3 Generate features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 Generate features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3a-in-built-support-for-resident-intruder-setup" class="md-nav__link">
    <span class="md-ellipsis">
      3a In-built support for resident-intruder setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3b-generic-features-that-work-for-any-animal-setup" class="md-nav__link">
    <span class="md-ellipsis">
      3b Generic features that work for any animal setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3c-add-your-own-features" class="md-nav__link">
    <span class="md-ellipsis">
      3c Add your own features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3d-features-manipulation" class="md-nav__link">
    <span class="md-ellipsis">
      3d Features manipulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4a-fit-a-model-for-behavior-classification" class="md-nav__link">
    <span class="md-ellipsis">
      4a Fit a model for behavior classification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4b-unsupervised-learning" class="md-nav__link">
    <span class="md-ellipsis">
      4b Unsupervised learning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-plotting" class="md-nav__link">
    <span class="md-ellipsis">
      5 Plotting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-make-output-movies" class="md-nav__link">
    <span class="md-ellipsis">
      6 Make output movies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-save-your-data" class="md-nav__link">
    <span class="md-ellipsis">
      7 Save your data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-summary-and-reference-list-of-added-functionality-by-ethome" class="md-nav__link">
    <span class="md-ellipsis">
      8 Summary and reference list of added functionality by ethome
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/interpolation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpolation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Io
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/plot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/unsupervised/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unsupervised
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-docs/video/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Video
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0-installation" class="md-nav__link">
    <span class="md-ellipsis">
      0 Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-loading-your-data" class="md-nav__link">
    <span class="md-ellipsis">
      1 Loading your data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1 Loading your data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1a-loading-nwb-files" class="md-nav__link">
    <span class="md-ellipsis">
      1a Loading NWB files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1b-loading-tracking-files" class="md-nav__link">
    <span class="md-ellipsis">
      1b Loading tracking files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1c-loading-behavioral-annotation-data" class="md-nav__link">
    <span class="md-ellipsis">
      1c Loading behavioral annotation data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1d-loading-video-data" class="md-nav__link">
    <span class="md-ellipsis">
      1d Loading video data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1e-scaling-pose-data" class="md-nav__link">
    <span class="md-ellipsis">
      1e Scaling pose data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1f-renaming-things" class="md-nav__link">
    <span class="md-ellipsis">
      1f Renaming things
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1g-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      1g Metadata
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-interpolate-low-confidence-pose-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      2 Interpolate low-confidence pose tracking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-generate-features" class="md-nav__link">
    <span class="md-ellipsis">
      3 Generate features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 Generate features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3a-in-built-support-for-resident-intruder-setup" class="md-nav__link">
    <span class="md-ellipsis">
      3a In-built support for resident-intruder setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3b-generic-features-that-work-for-any-animal-setup" class="md-nav__link">
    <span class="md-ellipsis">
      3b Generic features that work for any animal setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3c-add-your-own-features" class="md-nav__link">
    <span class="md-ellipsis">
      3c Add your own features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3d-features-manipulation" class="md-nav__link">
    <span class="md-ellipsis">
      3d Features manipulation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4a-fit-a-model-for-behavior-classification" class="md-nav__link">
    <span class="md-ellipsis">
      4a Fit a model for behavior classification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4b-unsupervised-learning" class="md-nav__link">
    <span class="md-ellipsis">
      4b Unsupervised learning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-plotting" class="md-nav__link">
    <span class="md-ellipsis">
      5 Plotting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-make-output-movies" class="md-nav__link">
    <span class="md-ellipsis">
      6 Make output movies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-save-your-data" class="md-nav__link">
    <span class="md-ellipsis">
      7 Save your data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-summary-and-reference-list-of-added-functionality-by-ethome" class="md-nav__link">
    <span class="md-ellipsis">
      8 Summary and reference list of added functionality by ethome
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="how-to-guide">How To guide</h1>
<p>This guide covers the all of the tasks you can perform with <code>ethome</code>, roughly in the order you'd want to do them. A very basic outline is also in the Quick Start section of the readme.</p>
<p>This guide covers basic usage -- it doesn't comprehensively describe how to use every function or feature in <code>ethome</code>; you can consult the API docs for complete information on usage. After installation, cut and paste the code samples below to follow along.</p>
<h2 id="0-installation">0 Installation</h2>
<p>Just do</p>
<pre><code>pip install ethome-ml
</code></pre>
<p>You may want to also install <code>tensorflow</code> if you want to use the CNN features for a resident-intruder setup.</p>
<h2 id="1-loading-your-data">1 Loading your data</h2>
<p><code>ethome</code> makes it easy to perform common machine learning analyses on pose-tracking data, perhaps in combination with behavioral annotations. The basic object of the package is an extended pandas <code>DataFrame</code>, which provides associated support functions that are suited for behavior analysis. The <code>DataFrame</code> object houses data from one or more video's worth of pose data, along with associated metadata for each video. The key thing you need to get started, then, is pose tracking data. At present, data from DeepLabCut, SLEAP or pose data stored in NWB files is supported (via the <code>ndx-pose</code> extension).</p>
<h3 id="1a-loading-nwb-files">1a Loading NWB files</h3>
<p>The NeurodataWithoutBorders format can store both pose tracking data and behavioral annotations, along with associated metadata. If all of your data is stored in this format, then it's easy to import it into <code>ethome</code>:</p>
<pre><code class="language-python">from ethome import create_dataset
from ethome.io import get_sample_nwb_paths
fn_in = get_sample_nwb_paths()
recordings = create_dataset(fn_in)
</code></pre>
<p>You can provide multiple recordings, just provide a list of paths instead. Each separate file is assumed to represent a similar setup but different session/experiment/time period. I.e., they're <em>not</em> meant to represent the same session from different cameras, or the same session for different animals.</p>
<h3 id="1b-loading-tracking-files">1b Loading tracking files</h3>
<p>If your data is stored in DeepLabCut <code>csv</code>s or <code>h5</code> files, or SLEAP exported analysis <code>h5</code> files, perhaps with accompanying behavioral annotations from <a href="https://www.boris.unito.it/">BORIS</a>, then you'll have to associate these with each other, and provide relevant metadata yourself. Sections 1b -&gt; 1e outline how to do this. Data stored in NWB files have already addressed each of these steps and you can skip these sections.</p>
<p>Let's get some sample data to play with:</p>
<pre><code class="language-python">from ethome.io import get_sample_data_paths
tracking_files, boris_files = get_sample_data_paths()
</code></pre>
<p>These are just lists of csv files containing our input data.</p>
<p>To import just your tracking data, you can simple do:</p>
<pre><code class="language-python">recordings = create_dataset(tracking_files)
</code></pre>
<p>But generally, you may want to provide metadata with each tracking file. This can be done just by providing keyword arguments:</p>
<pre><code class="language-python">fps = 30
resolution = (1200, 1600)
recordings = create_dataset(tracking_files, fps = fps, resolution = resolution)
</code></pre>
<p>This loads the dataframe, with <code>fps</code> and <code>resolution</code> associated to each input csv.</p>
<p>NOTE: Any keyword that is a list of the same length as the tracking files is zipped with the tracking files accordingly. That is, if the resolution of the videos is different:</p>
<pre><code class="language-python">fps = 30
resolutions = [(1200, 1600), (800, 1200)]
recordings = create_dataset(tracking_files[:2], fps = fps, resolution = resolutions)
</code></pre>
<p>Rather than assigning the same value to all videos, the entry <code>resolutions[i]</code> would then be associated with <code>tracking_csvs[i]</code>. These lists, therefore, must be sorted appropriately.</p>
<p>NOTE: It is strongly recommended the <code>fps</code> field is provided for all videos, so that frame numbers can be converted into times, which is needed for loading data from other sources (e.g. BORIS).</p>
<h3 id="1c-loading-behavioral-annotation-data">1c Loading behavioral annotation data</h3>
<p>The (optional) <code>labels</code> keyword is used to include corresponding behavioral annotation files:</p>
<pre><code class="language-python">recordings = create_dataset(tracking_files, labels = boris_files)
</code></pre>
<p>Behavior annotations should be exported from BORIS, in tabular form (as a csv), for each video to be imported.</p>
<h3 id="1d-loading-video-data">1d Loading video data</h3>
<p>The (optional) <code>video</code> keyword is used to provide the path(s) to the corresponding video(s) that were tracked. If available, this is used by some of the visualization functions.</p>
<h3 id="1e-scaling-pose-data">1e Scaling pose data</h3>
<p>There is some support for scaling the data to get it into desired units, consistent across all recordings.</p>
<p>If the tracking is in pixels and you do want to rescale it to some physical distance, you should provide keywords <code>frame_width</code>, <code>frame_width_units</code> and <code>resolution</code> for all videos. This ensures the entire dataset is using the same units. The package will use these values for each video to rescale the (presumed) pixel coordinates to physical coordinates.</p>
<p><code>resolution</code> is a tuple (H,W) in pixels of the videos and <code>frame_width</code> is the width of the image, in units <code>frame_width_units</code>.</p>
<p>By default, all coordinates are converted to 'mm'. The pair 'units':'mm' is added to the metadata dictionary for each video. You can specify the units by providing the <code>units</code> key yourself. Supported units include: 'mm', 'cm', 'm', 'in', 'ft'.</p>
<p>If the DLC/tracking files are already in desired units, either in physical distances, or pixels, then do <em>not</em> provide all of the fields <code>frame_width</code>, <code>resolution</code>, and <code>frame_width_units</code>. If you want to keep track of the units, you can add a <code>units</code> key to the metadata.</p>
<h3 id="1f-renaming-things">1f Renaming things</h3>
<p>If your tracking project named the animals some way, but you want them named another way in this dataframe, you can provide an <code>animal_renamer</code> dictionary as an argument to the constructor:</p>
<pre><code class="language-python">recordings = create_dataset(tracking_files,
                            labels = boris_files,
                            fps = 30,
                            animal_renamer={'adult': 'resident', 'juvenile':'intruder'})
</code></pre>
<p>Similarly with the body parts, you can provide a <code>part_renamer</code> dictionary.</p>
<h3 id="1g-metadata">1g Metadata</h3>
<p>When <code>recordings</code> is created, additional metadata is computed and accessible via:</p>
<ul>
<li><code>recordings.metadata</code> houses the following attributes:<ul>
<li><code>details</code>: all the metadata given to create_dataset</li>
<li><code>videos</code>: list of videos given in <code>metadata</code></li>
<li><code>n_videos</code>: number of videos in DataFrame</li>
<li><code>label_key</code>: associates numbers with text labels for each behavior</li>
<li><code>reverse_label_key</code>: associates text labels for each behavior number</li>
</ul>
</li>
<li><code>recordings.pose</code>, houses pose information:<ul>
<li><code>body_parts</code>: list of body parts loaded from the tracking file(s)</li>
<li><code>animals</code>: list of animals loaded from the tracking files(s)</li>
<li><code>animal_setup</code>: dictionary detailing animal parts and names</li>
<li><code>raw_track_columns</code>: all original columns names loaded from tracking</li>
</ul>
</li>
</ul>
<h2 id="2-interpolate-low-confidence-pose-tracking">2 Interpolate low-confidence pose tracking</h2>
<p>Some simple support for interpolating low-confidence tracks in DLC/SLEAP is provided. Predicted positions below a given confidence level can be noisy and unreliable, and better tracks may be obtained by removing these predictions and interpolating from more confident predictions on either side of the uncertain prediction.</p>
<p>You can achieve this with:</p>
<pre><code class="language-python">from ethome import interpolate_lowconf_points
interpolate_lowconf_points(recordings)
</code></pre>
<h2 id="3-generate-features">3 Generate features</h2>
<p>To do machine learning you'll want to create features from the pose tracking data. <code>ethome</code> can help you do this in a few different ways. You can either use one of the feature-making functions provided or create a custom feature-making function, or custom class.</p>
<p>To use the inbuilt functions you can reference them by their identifying string, or provide the function itself to the <code>features.add</code> function. For instance, to compute the distances between all body parts (within and between animals), you could do:</p>
<pre><code class="language-python">recordings.features.add('distances')
</code></pre>
<p>This will compute and add the distances between all body parts of all animals.</p>
<h3 id="3a-in-built-support-for-resident-intruder-setup">3a In-built support for resident-intruder setup</h3>
<p>First, if your setup is a social mouse study, involving two mice, similar enough to the standard resident-intruder setup, then you can use some pre-designed feature sets. The body parts that are tracked must be those from the MARS dataset [1] (See Figure). The MARS dataset is the Mouse Action Recognition System dataset, published by Segalin et al. It is a large, annotated mouse pose dataset that is useful for building ML models of mouse behavior. <code>ethome</code> uses pretrained models and feature sets that have been demonstrated to perform well at mouse action recognition on this dataset -- a combination of these models and features placed 3rd in AICrowd's <a href="https://www.aicrowd.com/challenges/multi-agent-behavior-representation-modeling-measurement-and-applications">Multiagent behavior contest</a> in 2021.</p>
<p>You will have to have labeled and tracked your mice in DLC/SLEAP in the same way. (with the same animal and body part names. Though <code>ethome</code>'s <code>create_dataset</code> function can help you rename them appropriately)</p>
<p><img alt="Resident-intruder keypoints" src="../assets/mars_keypoints.png" /></p>
<p>Specifically, the animals <em>must</em> be named <code>resident</code> and <code>intruder</code>, and the body parts must be: <code>nose</code>, <code>leftear</code>, <code>rightear</code>, <code>neck</code>, <code>lefthip</code>, <code>righthip</code>, and <code>tail</code>.</p>
<p>The <code>cnn1d_prob</code>, <code>mars</code>, <code>mars_reduced</code> and <code>social</code> functions can be used to make features for this setup.</p>
<ul>
<li><code>cnn1d_prob</code> runs a 1D CNN and outputs prediction probabilities of three behaviors (attack, mount, and investigation). Even if you're not interested in these exact behaviors, they may still be useful for predicting the occurance of other behaviors, as part of an ensemble model. The details of this pretrained model are found here: <a href="https://github.com/benlansdell/mabetask1_ml">https://github.com/benlansdell/mabetask1_ml</a>.</li>
<li><code>mars</code> computes a long list of features as used in the MARS paper. You can refer to that paper for more details.</li>
<li><code>mars_reduced</code> is a reduced version of the MARS features</li>
<li><code>social</code> is a set of features that only involve measures of one animal in relation to the other.</li>
</ul>
<h3 id="3b-generic-features-that-work-for-any-animal-setup">3b Generic features that work for any animal setup</h3>
<p>You can generate more generic features using the following inbuilt feature creation options:</p>
<ul>
<li><code>centroid</code> the centroid of each animal's body parts</li>
<li><code>centroid_velocity</code> the velocity of the centroids</li>
<li><code>centroid_interanimal</code> the distances between the centroids of all the animals</li>
<li><code>centroid_interanimal_speed</code> the rate of change of <code>centroid_interanimal</code></li>
<li><code>intrabodypartspeeds</code> the speeds of all body parts</li>
<li><code>intrabodypartdistances</code> the distances between all animals body parts (inter- and intra-animal)</li>
<li><code>distances</code> is an alias for <code>intrabodypartdistances</code></li>
</ul>
<p><strong>NOTE:</strong> These work for any animal setup, not just resident-intruder with specific body parts, as assumed for the <code>mars</code> features. Animals don't have to be labeled following the MARS convention for these features. </p>
<h3 id="3c-add-your-own-features">3c Add your own features</h3>
<p>There are two ways to add your own feature sets to your DataFrame.</p>
<p>The first is to create a function that takes a pandas DataFrame, and returns a new DataFrame with the features you want to add. For example:</p>
<pre><code class="language-python">def diff_cols(df, required_columns = []):
    return df[required_columns].diff()

recordings.features.add(diff_cols, required_columns = ['resident_x_neck', 'resident_y_neck'])
</code></pre>
<p>The second is to create a class that has, at the least, the method <code>transform</code>.</p>
<pre><code class="language-python">class BodyPartDiff:
    def __init__(self, required_columns):
        self.required_columns = required_columns

    def transform(self, df):
        return df[self.required_columns].diff()

head_diff = BodyPartDiff(['resident_x_neck', 'resident_y_neck'])
recordings.features.add(head_diff)
</code></pre>
<p>This is more verbose than the above, but has the advantage that the it can be re-used. E.g. you may want to fit the instance to training data and apply it to test data, similar to an sklearn model.</p>
<h3 id="3d-features-manipulation">3d Features manipulation</h3>
<p>By default, when new features are added to the dataframe, they are considered 'active'. Active simply means they can be accessed through the attribute:</p>
<pre><code class="language-python">recordings.ml.features
</code></pre>
<p>provided for convenience. You can pass this to any ML method for further processing. This <code>.ml.features</code> helps manage  the long list of features you will have created in the steps above. You can always just treat <code>recordings</code> like a Pandas DataFrame and do ML how you would normally.</p>
<p>To activate features you can use <code>recordings.features.activate</code>, and to deactivate features you can use <code>recordings.features.deactivate</code>. Deactivating keeps them in the DataFrame, but just no longer includes those features in the <code>recordings.ml.features</code> view.</p>
<h2 id="4a-fit-a-model-for-behavior-classification">4a Fit a model for behavior classification</h2>
<p>Ok! All the work is done and now you can easily train a behavior classifier based on the features you've computed and the labels provided.</p>
<p>E.g.</p>
<pre><code class="language-python">from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import cross_val_score, LeaveOneGroupOut

cv = LeaveOneGroupOut()
model = RandomForestClassifier()
cross_val_score(model, recordings.ml.features, recordings.ml.labels, recordings.ml.group, cv = cv)
</code></pre>
<p>A convenience function that essentially runs the above lines is provided,
<code>add_randomforest_predictions</code>:</p>
<pre><code class="language-python">from ethome import add_randomforest_predictions
add_randomforest_predictions(recordings)
</code></pre>
<p>which can be used as a starting point for developing behavior classifiers.</p>
<h2 id="4b-unsupervised-learning">4b Unsupervised learning</h2>
<p>Some basic functions are also provided that perform unsupervised learning. For instance</p>
<pre><code class="language-python">embedding = compute_umap_embedding(recordings, recordings.features.active, N_rows = 10000)
recordings[['embedding_0', 'embedding_1']] = embedding
</code></pre>
<p>Computes and stores a UMAP embedding of the computed features.</p>
<h2 id="5-plotting">5 Plotting</h2>
<p>You can plot this embedding via</p>
<pre><code class="language-python">fig, ax = plot_embedding(recordings, color_col = 'prediction')
</code></pre>
<p>There's also an interactive widget to explore the pose data</p>
<pre><code class="language-python">%matplotlib inline
filename = dataset.metadata.videos[0]
interactive_tracks(recordingsrecordings,
                   filename,
                   start_frame = 3000,
                   stop_frame = 4000)
</code></pre>
<p>viewable in a Jupyter notebook.</p>
<h2 id="6-make-output-movies">6 Make output movies</h2>
<p>Now we have our model we can make a video of its predictions. Provide the column names whose state we're going to overlay on the video, along with the directory to output the videos:</p>
<pre><code class="language-python">recordings.io.save_movie(['label', 'prediction'], '.')
</code></pre>
<p>The <code>video</code> argument, specifying the path to the underlying video, has to be present for each recording for this to work. Provide this as a keywork argument to <code>create_dataset</code>.</p>
<h2 id="7-save-your-data">7 Save your data</h2>
<p>Finally, you can save your data as a pickled DataFrame with</p>
<pre><code class="language-python">recordings.io.save('outfile.pkl')
</code></pre>
<p>(and can be loaded again with:)</p>
<pre><code class="language-python">import ethome
recordings = pd.DataFrame.io.load('outfile.pkl')
</code></pre>
<p>NOTE: By importing <code>ethome</code> you extend the functionality of the pandas DataFrame, hence can access things like <code>.io.load</code></p>
<h2 id="8-summary-and-reference-list-of-added-functionality-by-ethome">8 Summary and reference list of added functionality by <code>ethome</code></h2>
<p>For reference, the metadata and added functions added to the dataframe are:</p>
<ul>
<li><code>recordings.metadata</code>, which houses<ul>
<li><code>details</code>: the metadata dictionary given to create_dataset</li>
<li><code>videos</code>: list of videos given in <code>metadata</code></li>
<li><code>n_videos</code>: number of videos in DataFrame</li>
<li><code>label_key</code>: associates numbers with text labels for each behavior</li>
<li><code>reverse_label_key</code>: associates text labels for each behavior number</li>
</ul>
</li>
<li><code>recordings.pose</code>, houses pose information:<ul>
<li><code>body_parts</code>: list of body parts loaded from the DLC/SLEAP file(s)</li>
<li><code>animals</code>: list of animals loaded from the DLC/SLEAP files(s)</li>
<li><code>animal_setup</code>: dictionary detailing animal parts and names</li>
<li><code>raw_track_columns</code>: all original columns names loaded from DLC/SLEAP</li>
</ul>
</li>
<li><code>recordings.features</code>, feature creation and manipulation<ul>
<li><code>activate</code>: activate columns by name</li>
<li><code>deactivate</code>: deactivate columns by name</li>
<li><code>regex</code>: select column names based on regex</li>
<li><code>add</code>: create new features</li>
</ul>
</li>
<li><code>recordings.ml</code>, machine learning conveniences<ul>
<li><code>features</code>: a 'active' set of features</li>
<li><code>labels</code>: if loaded from BORIS, behavior labels. from text to label with <code>recordings.metadata.label_key</code></li>
<li><code>group</code>: the corresponding video filename for all rows in the table -- can be used for GroupKFold CV, or similar</li>
</ul>
</li>
<li><code>recordings.io</code>, I/O functions<ul>
<li><code>save</code>: save DataFrame as pickle file</li>
<li><code>to_dlc_csv</code>: save original tracking data back into csv -- if you interpolated or otherwise manipulated the data</li>
<li><code>load</code>: load DataFrame from pickle file</li>
<li><code>save_movie</code>: create a movie with some feature column you indicate overlaid</li>
</ul>
</li>
</ul>
<p>See the API docs for usage details.</p>
<h2 id="references">References</h2>
<p>[1] "The Mouse Action Recognition System (MARS) software pipeline for automated analysis of social behaviors in mice" Segalin et al. Elife 2021.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>